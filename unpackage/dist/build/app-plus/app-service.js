if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((o=>t.resolve(e()).then((()=>o))),(o=>t.resolve(e()).then((()=>{throw o}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...o){uni.__log__?uni.__log__(e,t,...o):console[e].apply(console,[...o,t])}const o=(t,o=0)=>(o,a=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,o,a)},a=o("onShow",3),n=o("onHide",3),l=o("onLaunch",1),i=o("onLoad",2);
/*!
   * pinia v2.1.7
   * (c) 2023 Eduardo San Martin Morote
   * @license MIT
   */
let r;const c=e=>r=e,s=Symbol();function d(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var u,m;(m=u||(u={})).direct="direct",m.patchObject="patch object",m.patchFunction="patch function";const p="undefined"!=typeof window;function g(){const t=e.effectScope(!0),o=t.run((()=>e.ref({})));let a=[],n=[];const l=e.markRaw({install(e){c(l),l._a=e,e.provide(s,l),e.config.globalProperties.$pinia=l,n.forEach((e=>a.push(e))),n=[]},use(e){return this._a?a.push(e):n.push(e),this},_p:a,_a:null,_e:t,_s:new Map,state:o});return l}const v=()=>{};function f(t,o,a,n=v){t.push(o);const l=()=>{const e=t.indexOf(o);e>-1&&(t.splice(e,1),n())};return!a&&e.getCurrentScope()&&e.onScopeDispose(l),l}function h(e,...t){e.slice().forEach((e=>{e(...t)}))}const y=e=>e();function E(t,o){t instanceof Map&&o instanceof Map&&o.forEach(((e,o)=>t.set(o,e))),t instanceof Set&&o instanceof Set&&o.forEach(t.add,t);for(const a in o){if(!o.hasOwnProperty(a))continue;const n=o[a],l=t[a];d(l)&&d(n)&&t.hasOwnProperty(a)&&!e.isRef(n)&&!e.isReactive(n)?t[a]=E(l,n):t[a]=n}return t}const w=Symbol();const{assign:k}=Object;function N(t,o,a={},n,l,i){let r;const s=k({actions:{}},a),m={deep:!0};let p,g,N,C=[],V=[];const T=n.state.value[t];let b;function S(o){let a;p=g=!1,"function"==typeof o?(o(n.state.value[t]),a={type:u.patchFunction,storeId:t,events:N}):(E(n.state.value[t],o),a={type:u.patchObject,payload:o,storeId:t,events:N});const l=b=Symbol();e.nextTick().then((()=>{b===l&&(p=!0)})),g=!0,h(C,a,n.state.value[t])}i||T||(n.state.value[t]={}),e.ref({});const x=i?function(){const{state:e}=a,t=e?e():{};this.$patch((e=>{k(e,t)}))}:v;function D(e,o){return function(){c(n);const a=Array.from(arguments),l=[],i=[];function r(e){l.push(e)}function s(e){i.push(e)}let d;h(V,{args:a,name:e,store:B,after:r,onError:s});try{d=o.apply(this&&this.$id===t?this:B,a)}catch(u){throw h(i,u),u}return d instanceof Promise?d.then((e=>(h(l,e),e))).catch((e=>(h(i,e),Promise.reject(e)))):(h(l,d),d)}}const _={_p:n,$id:t,$onAction:f.bind(null,V),$patch:S,$reset:x,$subscribe(o,a={}){const l=f(C,o,a.detached,(()=>i())),i=r.run((()=>e.watch((()=>n.state.value[t]),(e=>{("sync"===a.flush?g:p)&&o({storeId:t,type:u.direct,events:N},e)}),k({},m,a))));return l},$dispose:function(){r.stop(),C=[],V=[],n._s.delete(t)}},B=e.reactive(_);n._s.set(t,B);const I=(n._a&&n._a.runWithContext||y)((()=>n._e.run((()=>(r=e.effectScope()).run(o)))));for(const c in I){const o=I[c];if(e.isRef(o)&&(O=o,!e.isRef(O)||!O.effect)||e.isReactive(o))i||(!T||d(A=o)&&A.hasOwnProperty(w)||(e.isRef(o)?o.value=T[c]:E(o,T[c])),n.state.value[t][c]=o);else if("function"==typeof o){const e=D(c,o);I[c]=e,s.actions[c]=o}}var A,O;return k(B,I),k(e.toRaw(B),I),Object.defineProperty(B,"$state",{get:()=>n.state.value[t],set:e=>{S((t=>{k(t,e)}))}}),n._p.forEach((e=>{k(B,r.run((()=>e({store:B,app:n._a,pinia:n,options:s}))))})),T&&i&&a.hydrate&&a.hydrate(B.$state,T),p=!0,g=!0,B}function C(t,o,a){let n,l;const i="function"==typeof o;function d(t,a){const d=e.hasInjectionContext();(t=t||(d?e.inject(s,null):null))&&c(t),(t=r)._s.has(n)||(i?N(n,o,l,t):function(t,o,a,n){const{state:l,actions:i,getters:r}=o,s=a.state.value[t];let d;d=N(t,(function(){s||(a.state.value[t]=l?l():{});const o=e.toRefs(a.state.value[t]);return k(o,i,Object.keys(r||{}).reduce(((o,n)=>(o[n]=e.markRaw(e.computed((()=>{c(a);const e=a._s.get(t);return r[n].call(e,e)}))),o)),{}))}),o,a,0,!0)}(n,l,t));return t._s.get(n)}return"string"==typeof t?(n=t,l=i?a:o):(l=t,n=t.id),d.$id=n,d}let V="Store";function T(e,t){return Array.isArray(t)?t.reduce(((t,o)=>(t[o]=function(){return e(this.$pinia)[o]},t)),{}):Object.keys(t).reduce(((o,a)=>(o[a]=function(){const o=e(this.$pinia),n=t[a];return"function"==typeof n?n.call(this,o):o[n]},o)),{})}const b=T;const S=Object.freeze(Object.defineProperty({__proto__:null,get MutationType(){return u},PiniaVuePlugin:function(e){e.mixin({beforeCreate(){const e=this.$options;if(e.pinia){const t=e.pinia;if(!this._provided){const e={};Object.defineProperty(this,"_provided",{get:()=>e,set:t=>Object.assign(e,t)})}this._provided[s]=t,this.$pinia||(this.$pinia=t),t._a=this,p&&c(t)}else!this.$pinia&&e.parent&&e.parent.$pinia&&(this.$pinia=e.parent.$pinia)},destroyed(){delete this._pStores}})},acceptHMRUpdate:function(e,t){return()=>{}},createPinia:g,defineStore:C,getActivePinia:()=>e.hasInjectionContext()&&e.inject(s)||r,mapActions:function(e,t){return Array.isArray(t)?t.reduce(((t,o)=>(t[o]=function(...t){return e(this.$pinia)[o](...t)},t)),{}):Object.keys(t).reduce(((o,a)=>(o[a]=function(...o){return e(this.$pinia)[t[a]](...o)},o)),{})},mapGetters:b,mapState:T,mapStores:function(...e){return e.reduce(((e,t)=>(e[t.$id+V]=function(){return t(this.$pinia)},e)),{})},mapWritableState:function(e,t){return Array.isArray(t)?t.reduce(((t,o)=>(t[o]={get(){return e(this.$pinia)[o]},set(t){return e(this.$pinia)[o]=t}},t)),{}):Object.keys(t).reduce(((o,a)=>(o[a]={get(){return e(this.$pinia)[t[a]]},set(o){return e(this.$pinia)[t[a]]=o}},o)),{})},setActivePinia:c,setMapStoreSuffix:function(e){V=e},skipHydrate:function(e){return Object.defineProperty(e,w,{})},storeToRefs:function(t){{t=e.toRaw(t);const o={};for(const a in t){const n=t[a];(e.isRef(n)||e.isReactive(n))&&(o[a]=e.toRef(t,a))}return o}}},Symbol.toStringTag,{value:"Module"})),x="CALL",D="CUSTOMER",_="CONVERSATION",B="CHAT_MESSAGE",I="Desktop-RTC",A="TODO",O="",L="",F="",$="",M="",R="",P="072836272322",U="#000000",j="transparent",z="Normal",H="https://api-sandbox-h01.vbot.vn/v1.0",G=`${H}/api/module-crm`,K=`${H}/api/project`,q=`${H}/api/module-todo/todo`,Y="PR202511211001129372",X=(e,t)=>{const o=W();return J({url:`${G}/token`,method:"GET",data:{projectCode:e,uid:t,type:"CRM",source:I},header:{Authorization:`Bearer ${o.rootToken}`}}).then((e=>e.token))},W=C("auth",{state:()=>({rootToken:uni.getStorageSync("vbot_root_token")||"",rootLoginTime:uni.getStorageSync("vbot_root_login_time")||0,todoToken:uni.getStorageSync("todo_access_token")||"",crmToken:uni.getStorageSync("crm_access_token")||"",uid:uni.getStorageSync("vbot_uid")||"",projectCode:uni.getStorageSync("vbot_project_code")||""}),getters:{isLoggedIn:e=>!!e.todoToken&&!!e.crmToken,isRootTokenValid:e=>{if(!e.rootToken||!e.rootLoginTime)return!1;return Date.now()-e.rootLoginTime<6048e5}},actions:{setAuthData(e){e.rootToken&&(this.rootToken=e.rootToken,uni.setStorageSync("vbot_root_token",e.rootToken),this.rootLoginTime=Date.now(),uni.setStorageSync("vbot_root_login_time",this.rootLoginTime)),e.uid&&(this.uid=e.uid,uni.setStorageSync("vbot_uid",e.uid)),e.projectCode&&(this.projectCode=e.projectCode,uni.setStorageSync("vbot_project_code",e.projectCode)),e.todoToken&&(this.todoToken=e.todoToken,uni.setStorageSync("todo_access_token",e.todoToken)),e.crmToken&&(this.crmToken=e.crmToken,uni.setStorageSync("crm_access_token",e.crmToken))},async fetchModuleTokens(){try{if(!this.isRootTokenValid)return t("log","at stores/auth.ts:61","Root Token hết hạn, login lại..."),void(await this.loginDevMode());t("log","at stores/auth.ts:66","Store: Đang lấy Token cho Todo và CRM...");const[n,l]=await Promise.all([(e=this.rootToken,o=this.projectCode,a=this.uid,new Promise(((t,n)=>{uni.request({url:`${G}/token`,method:"GET",data:{projectCode:o,uid:a,type:A,source:I},header:{Authorization:`Bearer ${e}`},success:e=>{const o=e.data;o&&o.data&&o.data.token?t(o.data.token):n(o)},fail:e=>n(e)})}))),X(this.projectCode,this.uid)]);this.setAuthData({todoToken:n,crmToken:l}),t("log","at stores/auth.ts:78"," Store: Đã lấy đủ Token (Todo & CRM).")}catch(n){throw t("error","at stores/auth.ts:80"," Store: Lỗi lấy module tokens:",n),this.logout(),n}var e,o,a},async loginDevMode(){try{t("log","at stores/auth.ts:97","Store: Đang gọi API đăng nhập hệ thống...");const a=await(e="hoangtinvpm",o="ef797c8118f02dfb649607dd5d3f8c7623048c9c063d532cc95c5ed7a898a64f",new Promise(((t,a)=>{uni.request({url:"https://api-sandbox-h01.vbot.vn/v1.0/token",method:"POST",header:{"Content-Type":"application/x-www-form-urlencoded"},data:{username:e,password:o,grant_type:"password",type_account:0,source:I},success:e=>{const o=e.data;200===e.statusCode&&o.access_token?t(o):a(o)},fail:e=>a(e)})})));this.setAuthData({rootToken:a.access_token,uid:"87d90802634146e29721476337bce64b",projectCode:"PR202511211001129372"}),await this.fetchModuleTokens()}catch(a){t("error","at stores/auth.ts:108"," Store: Đăng nhập Dev thất bại",a)}var e,o},async initialize(e){if(t("log","at stores/auth.ts:113"," Store: Khởi tạo Auth..."),this.todoToken&&this.crmToken)t("log","at stores/auth.ts:115",">>  Đã có đủ Token cũ. Ready!");else{if(this.isRootTokenValid)return t("log","at stores/auth.ts:120","️ Thiếu token module, đang lấy lại..."),void(await this.fetchModuleTokens());t("log","at stores/auth.ts:125","Root Token hết hạn. Login lại..."),await this.loginDevMode()}},async exchangeForTodoToken(){await this.fetchModuleTokens()},logout(){t("log","at stores/auth.ts:132","Store: Đăng xuất..."),this.rootToken="",this.rootLoginTime=0,this.todoToken="",this.crmToken="",uni.removeStorageSync("crm_access_token"),uni.removeStorageSync("todo_access_token"),uni.removeStorageSync("vbot_root_token"),uni.removeStorageSync("vbot_root_login_time")}}}),J=async e=>{const o=W(),a=o.todoToken||o.rootToken,n={"Content-Type":"application/json",...e.header};return a&&(n.Authorization=`Bearer ${a}`),new Promise(((a,l)=>{uni.request({url:e.url,method:e.method||"GET",data:e.data||{},header:n,success:async n=>{const i=n.data;if(200!==n.statusCode)if(401!==n.statusCode)t("error","at utils/request.ts:65",`[API Error ${n.statusCode}]`,i),l(i);else{if(t("warn","at utils/request.ts:39",`API 401: Token hết hạn tại ${e.url}`),e._isRetry)return t("error","at utils/request.ts:42"," Refresh Token cũng thất bại -> Logout."),o.logout(),void l(i);try{await o.exchangeForTodoToken(),t("log","at utils/request.ts:50"," Đã Refresh Token -> Đang gọi lại API cũ...");const n=await J({...e,_isRetry:!0});a(n)}catch(r){o.logout(),l(r)}}else a(i.data)},fail:e=>{t("error","at utils/request.ts:70","[Network Error]",e),l(e)}})}))},Q="TO_DO",Z="IN_PROGRESS",ee="DONE",te={TO_DO:"Chờ xử lý",IN_PROGRESS:"Đang xử lý",DONE:"Hoàn thành"},oe={TO_DO:"bg-gray",IN_PROGRESS:"bg-orange",DONE:"bg-green"},ae={HISTORY_CALL_IN:"Cuộc gọi đến",HISTORY_CALL_OUT:"Cuộc gọi đi",HISTORY_MISS_CALL:"Cuộc gọi nhỡ",NEW_TICKET:"Tạo mới ticket",REOPEN_TICKET:"Mở lại ticket",NEW_SUB_TICKET:"Tạo ticket con",UPDATE_STATUS_TICKET:"Cập nhật trạng thái ticket",UPDATE_ASSIGNEE_TICKET:"Đổi người xử lý ticket",NEW_TODO:"Tạo mới công việc",REOPEN_TODO:"Mở lại công việc",UPDATE_STATUS_TODO:"Cập nhật trạng thái công việc",UPDATE_ASSIGNEE_TODO:"Đổi người thực hiện công việc",CUSTOMER_UPDATE:"Cập nhật thông tin khách hàng",NOTE_INSERT:"Thêm ghi chú",NOTE_UPDATE:"Sửa ghi chú",NOTE_DELETE:"Xóa ghi chú"},ne=e=>{if(!e||-1===e||0===e)return"";const t=new Date(e);return`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()} ${t.getHours().toString().padStart(2,"0")}:${t.getMinutes().toString().padStart(2,"0")}:${t.getSeconds().toString().padStart(2,"0")}`},le=e=>e?new Date(e).getTime():-1,ie=async e=>{const t=await J({url:`${q}/getAll`,method:"GET",data:{projectCode:Y,pageNo:1,pageSize:15,...e}});return Array.isArray(t)?t.map((e=>(e=>{if(!e)return{};const t=e.status||Q,o=e.title||"Không tên";return{...e,title:o,statusClass:oe[t]||"bg-orange",statusLabel:te[t]||t,avatarText:o.substring(0,2).toUpperCase(),createdAtFormatted:ne(e.createdAt)}})(e))):[]},re=async e=>{const t=await J({url:`${q}/countAll`,method:"GET",data:{projectCode:Y,...e}});return Number(t)||0},ce=e=>J({url:`${q}/update`,method:"POST",data:e}),se=e=>J({url:`${H}/api/module-todo/todoMessages/create`,method:"POST",data:e}),de=()=>{const e=W(),{rootToken:t,projectCode:o}=e;return new Promise(((e,a)=>{uni.request({url:`${K}/getAllMember`,method:"GET",data:{projectCode:o,status:"all"},header:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},success:t=>{const o=t.data;1===o.status&&o.data?e(o.data):a(o.message||"Lỗi lấy danh sách thành viên")},fail:e=>{a(e)}})}))},ue=()=>{const o=e.ref([]),n=e.ref(!1),l=e.ref(!1),i=e.ref(!1),r=e.ref(null),c=["Tất cả",te[Q],te[Z],te[ee]],s=["",Q,Z,ee],d=e.ref(0),u=e.ref([]),m=e.ref(["Tất cả"]),p=e.ref(0),g=e.ref(0),v=e.ref(["Tất cả"]),f=e.ref(0),h=["",x,D,_,B],y=e.ref(0),E=e.ref({title:"",jobCode:"",createdFrom:"",createdTo:"",dueDateFrom:"",dueDateTo:""}),w=[5,10,15,20],k=e.ref(2),N=e.ref(1),C=e.ref(0),V=e.computed((()=>{if(0===C.value)return 1;const e=w[k.value];return Math.ceil(C.value/e)})),T=async()=>{n.value=!0;try{let e="";p.value>0&&(e=u.value[p.value-1].UID);let t="";f.value>0&&(t=u.value[f.value-1].memberUID);const a=((e,t,o,a,n)=>({keySearch:e.title||"",code:e.jobCode||"",status:t||"",startDate:le(e.createdFrom),endDate:le(e.createdTo),dueDateFrom:le(e.dueDateFrom),dueDateTo:le(e.dueDateTo),createdBy:a||"",assigneeId:n||"",links:o||"",customerCode:"",groupId:"",transId:"",pluginType:""}))(E.value,s[d.value],h[y.value],e,t),l=w[k.value],[i,r]=await Promise.all([ie({...a,pageNo:N.value,pageSize:l}),re(a)]);o.value=i||[],C.value=r||0}catch(e){t("error","at controllers/list_todo.ts:118",e),uni.showToast({title:"Lỗi tải dữ liệu",icon:"none"})}finally{n.value=!1}},b=()=>{l.value=!1};a((()=>{T()}));return{todos:o,isLoading:n,isFilterOpen:l,filter:E,goToDetail:e=>{uni.navigateTo({url:`/pages/todo/todo_detail?id=${e.id}`})},isConfirmDeleteOpen:i,itemToDelete:r,pageSizeOptions:["5/trang","10/trang","15/trang","20/trang"],pageSizeIndex:k,currentPage:N,totalPages:V,totalItems:C,onPageSizeChange:e=>{k.value=e.detail.value,N.value=1,T()},changePage:e=>{const t=N.value+e;t>=1&&t<=V.value&&(N.value=t,T())},statusOptions:c,statusIndex:d,onStatusChange:e=>{d.value=e.detail.value},creatorOptions:m,creatorIndex:p,onCreatorChange:e=>{p.value=e.detail.value},assigneeOptions:v,assigneeIndex:f,onAssigneeChange:e=>{f.value=e.detail.value},customerOptions:["Tất cả","KH001","KH002","VNG"],customerIndex:g,onCustomerChange:e=>{g.value=e.detail.value},sourceOptions:["Tất cả","Cuộc gọi (CALL)","Khách hàng (CUSTOMER)","Hội thoại (CONVERSATION)","Tin nhắn (CHAT_MESSAGE)"],sourceIndex:y,onSourceChange:e=>{y.value=e.detail.value},addNewTask:()=>{uni.navigateTo({url:"/pages/todo/create_todo"})},openFilter:()=>{l.value=!0,(async()=>{if(!(u.value.length>0))try{const e=await de();u.value=e;const t=e.map((e=>e.UserName||"Thành viên ẩn"));m.value=["Tất cả",...t],v.value=["Tất cả",...t]}catch(e){t("error","at controllers/list_todo.ts:73","Lỗi lấy danh sách thành viên filter:",e)}})()},closeFilter:b,resetFilter:()=>{E.value={title:"",jobCode:"",createdFrom:"",createdTo:"",dueDateFrom:"",dueDateTo:""},d.value=0,p.value=0,g.value=0,f.value=0,y.value=0,N.value=1},applyFilter:()=>{N.value=1,b(),T()},showActionMenu:e=>{uni.showActionSheet({itemList:["Xóa"],itemColor:"#ff3b30",success:t=>{0===t.tapIndex&&(e=>{r.value=e,i.value=!0})(e)}})},cancelDelete:()=>{i.value=!1,r.value=null},confirmDelete:async()=>{var e;if(r.value)try{await(e=r.value.id,J({url:`${q}/delete`,method:"POST",data:{id:e}})),uni.showToast({title:"Đã xóa thành công",icon:"success"}),i.value=!1,r.value=null,T()}catch(o){t("error","at controllers/list_todo.ts:153","Delete Error:",o),uni.showToast({title:"Xóa thất bại",icon:"none"})}}}},me=(e,t)=>{const o=e.__vccOpts||e;for(const[a,n]of t)o[a]=n;return o},pe=me(e.defineComponent({__name:"StatusBadge",props:{status:{}},setup(t){const o=t,a=e.computed((()=>te[o.status]||o.status||"Không xác định")),n=e.computed((()=>{switch(o.status){case Q:return"bg-gray-200 text-gray-600";case Z:return"bg-orange-100 text-orange-600";case ee:return"bg-green-100 text-green-600";default:return"bg-gray-100 text-gray-400"}})),l=e.computed((()=>{switch(o.status){case Q:return{backgroundColor:"#e4e4e7",color:"#52525b"};case Z:return{backgroundColor:"#ffedd5",color:"#c2410c"};case ee:return{backgroundColor:"#dcfce7",color:"#15803d"};default:return{backgroundColor:"#f4f4f5",color:"#a1a1aa"}}}));return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:e.normalizeClass(["px-2 py-1 rounded-full text-xs font-bold inline-block text-center min-w-[80px]",n.value]),style:e.normalizeStyle(l.value)},e.toDisplayString(a.value),7))}}),[["__scopeId","data-v-91c2abdf"]]),ge=me(e.defineComponent({__name:"list_todo",setup(t){const{todos:o,isLoading:a,isFilterOpen:n,filter:l,isConfirmDeleteOpen:i,itemToDelete:r,pageSizeOptions:c,pageSizeIndex:s,currentPage:d,totalPages:u,onPageSizeChange:m,changePage:p,statusOptions:g,statusIndex:v,onStatusChange:f,creatorOptions:h,creatorIndex:y,onCreatorChange:E,customerOptions:w,customerIndex:k,onCustomerChange:N,assigneeOptions:C,assigneeIndex:V,onAssigneeChange:T,sourceOptions:b,sourceIndex:S,onSourceChange:x,addNewTask:D,openFilter:_,closeFilter:B,resetFilter:I,applyFilter:A,showActionMenu:O,cancelDelete:L,confirmDelete:F,goToDetail:$}=ue();return(t,M)=>{var R;return e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"header"},[e.createElementVNode("view",{class:"header-left"}),e.createElementVNode("text",{class:"header-title"},"Công việc"),e.createElementVNode("view",{class:"header-right",onClick:M[0]||(M[0]=(...t)=>e.unref(_)&&e.unref(_)(...t))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios-filled/50/333333/filter--v1.png",class:"filter-icon"})])]),e.createElementVNode("view",{class:"content"},[e.createElementVNode("view",{class:"list-container"},[e.unref(a)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-state"},[e.createElementVNode("text",null,"Đang tải dữ liệu...")])):0===e.unref(o).length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-state"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/100/cccccc/empty-box.png",mode:"aspectFit",class:"empty-icon"}),e.createElementVNode("text",{class:"empty-text"},"Chưa có dữ liệu")])):(e.openBlock(),e.createElementBlock("scroll-view",{key:2,"scroll-y":"true",class:"list-view"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o),((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:t.id||o,class:"card-item",onClick:o=>e.unref($)(t)},[e.createElementVNode("view",{class:e.normalizeClass(["status-bar",t.statusClass])},null,2),e.createElementVNode("view",{class:"card-body"},[e.createElementVNode("view",{class:"card-row top-row"},[e.createElementVNode("text",{class:"card-title"},e.toDisplayString(t.title),1),e.createElementVNode("view",{class:"action-btn",onClick:e.withModifiers((o=>e.unref(O)(t)),["stop"])},[e.createElementVNode("text",{class:"dots"},"•••")],8,["onClick"])]),e.createElementVNode("view",{class:"card-row mid-row"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/time.png",class:"icon-small"}),e.createElementVNode("text",{class:"card-date"},"Ngày tạo: "+e.toDisplayString(t.createdAtFormatted),1)]),e.createElementVNode("view",{class:"card-row bot-row"},[e.createElementVNode("view",{class:"code-tag"},"#"+e.toDisplayString(t.code),1),e.createVNode(pe,{status:t.status},null,8,["status"])])])],8,["onClick"])))),128)),e.createElementVNode("view",{style:{height:"20px"}})]))]),e.createElementVNode("view",{class:"fixed-footer"},[e.createElementVNode("picker",{mode:"selector",range:e.unref(c),value:e.unref(s),onChange:M[1]||(M[1]=(...t)=>e.unref(m)&&e.unref(m)(...t))},[e.createElementVNode("view",{class:"page-size-selector"},[e.createElementVNode("text",{class:"size-text"},e.toDisplayString(e.unref(c)[e.unref(s)]),1),e.createElementVNode("text",{class:"dropdown-arrow"},"▼")])],40,["range","value"]),e.createElementVNode("view",{class:"pagination-controls"},[e.createElementVNode("view",{class:e.normalizeClass(["page-arrow",{disabled:e.unref(d)<=1}]),onClick:M[2]||(M[2]=t=>e.unref(p)(-1))},"‹",2),e.createElementVNode("view",{class:"page-box active"},e.toDisplayString(e.unref(d)),1),e.createElementVNode("view",{class:e.normalizeClass(["page-arrow",{disabled:e.unref(d)>=e.unref(u)}]),onClick:M[3]||(M[3]=t=>e.unref(p)(1))},"›",2)]),e.createElementVNode("view",{class:"add-task-simple",onClick:M[4]||(M[4]=(...t)=>e.unref(D)&&e.unref(D)(...t))},[e.createElementVNode("text",{class:"plus-icon"},"+"),e.createElementVNode("text",{class:"add-text"},"Thêm công việc")])])]),e.unref(n)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"filter-overlay",onClick:M[20]||(M[20]=e.withModifiers(((...t)=>e.unref(B)&&e.unref(B)(...t)),["stop"]))},[e.createElementVNode("view",{class:"filter-panel",onClick:M[19]||(M[19]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"filter-header"},[e.createElementVNode("text",{class:"filter-title"},"Bộ lọc tìm kiếm"),e.createElementVNode("text",{class:"close-btn",onClick:M[5]||(M[5]=(...t)=>e.unref(B)&&e.unref(B)(...t))},"✕")]),e.createElementVNode("scroll-view",{"scroll-y":"true",class:"filter-body"},[e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Tiêu đề / Từ khóa"),e.withDirectives(e.createElementVNode("input",{class:"f-input","onUpdate:modelValue":M[6]||(M[6]=t=>e.unref(l).title=t),placeholder:"Nhập từ khóa..."},null,512),[[e.vModelText,e.unref(l).title]])]),e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Mã công việc"),e.withDirectives(e.createElementVNode("input",{class:"f-input","onUpdate:modelValue":M[7]||(M[7]=t=>e.unref(l).jobCode=t),placeholder:"Ví dụ: TODO-08"},null,512),[[e.vModelText,e.unref(l).jobCode]])]),e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Trạng thái"),e.createElementVNode("picker",{mode:"selector",range:e.unref(g),value:e.unref(v),onChange:M[8]||(M[8]=(...t)=>e.unref(f)&&e.unref(f)(...t))},[e.createElementVNode("view",{class:"f-picker"},[e.createTextVNode(e.toDisplayString(e.unref(g)[e.unref(v)]),1),e.createElementVNode("text",{class:"arrow"},"▼")])],40,["range","value"])]),e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Người tạo"),e.createElementVNode("picker",{mode:"selector",range:e.unref(h),value:e.unref(y),onChange:M[9]||(M[9]=(...t)=>e.unref(E)&&e.unref(E)(...t))},[e.createElementVNode("view",{class:"f-picker"},[e.createTextVNode(e.toDisplayString(e.unref(h)[e.unref(y)]),1),e.createElementVNode("text",{class:"arrow"},"▼")])],40,["range","value"])]),e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Mã khách hàng"),e.createElementVNode("picker",{mode:"selector",range:e.unref(w),value:e.unref(k),onChange:M[10]||(M[10]=(...t)=>e.unref(N)&&e.unref(N)(...t))},[e.createElementVNode("view",{class:"f-picker"},[e.createTextVNode(e.toDisplayString(e.unref(w)[e.unref(k)]),1),e.createElementVNode("text",{class:"arrow"},"▼")])],40,["range","value"])]),e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Người được giao"),e.createElementVNode("picker",{mode:"selector",range:e.unref(C),value:e.unref(V),onChange:M[11]||(M[11]=(...t)=>e.unref(T)&&e.unref(T)(...t))},[e.createElementVNode("view",{class:"f-picker"},[e.createTextVNode(e.toDisplayString(e.unref(C)[e.unref(V)]),1),e.createElementVNode("text",{class:"arrow"},"▼")])],40,["range","value"])]),e.createElementVNode("view",{class:"f-group"},[e.createElementVNode("text",{class:"f-label"},"Nguồn"),e.createElementVNode("picker",{mode:"selector",range:e.unref(b),value:e.unref(S),onChange:M[12]||(M[12]=(...t)=>e.unref(x)&&e.unref(x)(...t))},[e.createElementVNode("view",{class:"f-picker"},[e.createTextVNode(e.toDisplayString(e.unref(b)[e.unref(S)]),1),e.createElementVNode("text",{class:"arrow"},"▼")])],40,["range","value"])]),e.createElementVNode("view",{class:"f-section-title"},"Thời gian tạo"),e.createElementVNode("view",{class:"f-row"},[e.createElementVNode("view",{class:"f-group half"},[e.createElementVNode("picker",{mode:"date",value:e.unref(l).createdFrom,onChange:M[13]||(M[13]=t=>e.unref(l).createdFrom=t.detail.value)},[e.createElementVNode("view",{class:"f-picker date"},e.toDisplayString(e.unref(l).createdFrom||"Từ ngày"),1)],40,["value"])]),e.createElementVNode("view",{class:"f-group half"},[e.createElementVNode("picker",{mode:"date",value:e.unref(l).createdTo,onChange:M[14]||(M[14]=t=>e.unref(l).createdTo=t.detail.value)},[e.createElementVNode("view",{class:"f-picker date"},e.toDisplayString(e.unref(l).createdTo||"Đến ngày"),1)],40,["value"])])]),e.createElementVNode("view",{class:"f-section-title"},"Thời gian hết hạn"),e.createElementVNode("view",{class:"f-row"},[e.createElementVNode("view",{class:"f-group half"},[e.createElementVNode("picker",{mode:"date",value:e.unref(l).dueDateFrom,onChange:M[15]||(M[15]=t=>e.unref(l).dueDateFrom=t.detail.value)},[e.createElementVNode("view",{class:"f-picker date"},e.toDisplayString(e.unref(l).dueDateFrom||"Từ ngày"),1)],40,["value"])]),e.createElementVNode("view",{class:"f-group half"},[e.createElementVNode("picker",{mode:"date",value:e.unref(l).dueDateTo,onChange:M[16]||(M[16]=t=>e.unref(l).dueDateTo=t.detail.value)},[e.createElementVNode("view",{class:"f-picker date"},e.toDisplayString(e.unref(l).dueDateTo||"Đến ngày"),1)],40,["value"])])]),e.createElementVNode("view",{style:{height:"20px"}})]),e.createElementVNode("view",{class:"filter-footer"},[e.createElementVNode("button",{class:"btn-reset",onClick:M[17]||(M[17]=(...t)=>e.unref(I)&&e.unref(I)(...t))},"Đặt lại"),e.createElementVNode("button",{class:"btn-apply",onClick:M[18]||(M[18]=(...t)=>e.unref(A)&&e.unref(A)(...t))},"Áp dụng")])])])):e.createCommentVNode("",!0),e.unref(i)?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal-overlay",onClick:M[23]||(M[23]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-container"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"Thông báo")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,'Bạn có chắc muốn xóa công việc "'+e.toDisplayString(null==(R=e.unref(r))?void 0:R.title)+'"?',1)]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:M[21]||(M[21]=(...t)=>e.unref(L)&&e.unref(L)(...t))},"Hủy"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:M[22]||(M[22]=(...t)=>e.unref(F)&&e.unref(F)(...t))},"Xác nhận")])])])):e.createCommentVNode("",!0)])}}}),[["__scopeId","data-v-eaaca803"]]),ve=e=>{if(!e)return-1;const t=e.replace(/\//g,"-"),o=new Date(t);return isNaN(o.getTime())?-1:o.getTime()},fe=()=>{const o=W(),a=e=>e.toString().padStart(2,"0"),n=()=>{const e=new Date;return`${e.getFullYear()}-${a(e.getMonth()+1)}-${a(e.getDate())}`},l=e.ref(!1),i=e.ref({name:"",desc:"",customer:"",customerUid:"",assignee:"",dueDate:n(),notifyDate:n(),notifyTime:(()=>{const e=new Date;return`${a(e.getHours())}:${a(e.getMinutes())}`})()}),r=[x,D,_],c=e.ref(-1),s=e.ref([]),d=e.ref([]),u=e.ref(-1),m=e.ref(!1),p=e.ref(!1),g=e.ref([]),v=e.ref(""),f=async()=>{if(!(g.value.length>0)){p.value=!0;try{const a=o.crmToken;if(!a)return void t("error","at controllers/create_todo.ts:75","Chưa có CRM Token!");v.value=a;const n=await(e=a,J({url:`${G}/Customer/getAllFieldSearch`,method:"POST",data:{},header:{Authorization:`Bearer ${e}`}})),l=n.find((e=>"name"===e.code)),i=n.find((e=>"phone"===e.code)),r=n.find((e=>"member_no"===e.code)),c=l?l.id:134,s=i?i.id:135,d={page:1,size:20,fieldSearch:[{id:-1,value:"",type:"",isSearch:!1},{id:c,value:"",type:"",isSearch:!1},{id:s,value:"",type:"",isSearch:!1},{id:r?r.id:136,value:"",type:"",isSearch:!1}]},u=await((e,t)=>J({url:`${G}/Customer/getAll`,method:"POST",data:t,header:{Authorization:`Bearer ${e}`}}))(a,d);g.value=u.map((e=>{const t=e.customerFieldItems.find((e=>"name"===e.code)),o=e.customerFieldItems.find((e=>"phone"===e.code));return{id:e.id,uid:e.uid,createAt:e.createAt,name:t?t.value:"(Không tên)",phone:o?o.value:""}}))}catch(a){t("error","at controllers/create_todo.ts:123","Lỗi tải khách hàng:",a),uni.showToast({title:"Lỗi tải dữ liệu CRM",icon:"none"})}finally{p.value=!1}var e}},h=e.computed((()=>u.value>-1&&d.value.length>0?d.value[u.value]:""));return e.onMounted((()=>{(async()=>{try{const e=await de();s.value=e,d.value=e.map((e=>e.UserName||"Thành viên ẩn danh"))}catch(e){t("error","at controllers/create_todo.ts:61","Lỗi lấy thành viên:",e),uni.showToast({title:"Không thể tải danh sách thành viên",icon:"none"})}})()})),{loading:l,form:i,memberOptions:d,onMemberChange:e=>{const t=e.detail.value;u.value=t;const o=s.value[t];o&&(i.value.assignee=o.memberUID)},currentAssigneeName:h,showCustomerModal:m,loadingCustomer:p,customerList:g,openCustomerPopup:()=>{m.value=!0,f()},onCustomerSelect:e=>{i.value.customer=`${e.name} - ${e.phone}`,i.value.customerUid=e.uid},goBack:()=>uni.navigateBack(),submitForm:async()=>{if(!i.value.name||!i.value.name.trim())return void uni.showToast({title:"Vui lòng nhập tên công việc",icon:"none"});let e="CALL";e=c.value>=0?r[c.value]:"CALL",l.value=!0;try{const t=((e,t)=>{const o=`${e.notifyDate} ${e.notifyTime||"00:00"}`,a=e.dueDate;return{title:e.name,description:e.desc||O,projectCode:t.projectCode,createdBy:t.uid,status:Q,links:t.link||x,pluginType:L,customerCode:e.customerUid||R,assigneeId:e.assignee||M,groupId:F,transId:$,tagCodes:"test1",groupMemberUid:"test1",files:O,phone:P,dueDate:ve(a),notificationReceivedAt:ve(o)}})(i.value,{projectCode:Y,uid:"87d90802634146e29721476337bce64b",link:e});await(o=t,J({url:`${q}/create`,method:"POST",data:o})),uni.showToast({title:"Tạo thành công!",icon:"success"}),setTimeout((()=>{uni.navigateBack()}),1500)}catch(a){t("error","at controllers/create_todo.ts:196","❌ Create Error:",a);const e=(null==a?void 0:a.message)||"Thất bại";uni.showToast({title:"Lỗi: "+e,icon:"none"})}finally{l.value=!1}var o},sourceOptions:["Cuộc gọi","Khách hàng","Hội thoại"],sourceIndex:c,onSourceChange:e=>{c.value=parseInt(e.detail.value)}}},he=me(e.defineComponent({__name:"TodoEditor",props:{modelValue:{},placeholder:{}},emits:["update:modelValue"],setup(o,{emit:a}){const n=o,l=a,i=e.ref(`editor-${Math.random().toString(36).substring(2,9)}`),r=e.ref(null),c=e.ref({}),s=e.getCurrentInstance();e.ref(!1);const d=e.ref(!1),u=e.ref(""),m=e.ref(""),p=e.ref(!1),g=e.ref(!1),v=e.ref(!1),f=e.ref(!1),h=e.ref("color"),y=e.ref(U),E=e.ref(j),w=e.ref(z),k=["#000000","#424242","#666666","#999999","#B7B7B7","#CCCCCC","#D9D9D9","#EFEFEF","#F3F3F3","#FFFFFF","#980000","#FF0000","#FF9900","#FFFF00","#00FF00","#00FFFF","#4A86E8","#0000FF","#9900FF","#FF00FF","#CC4125","#E06666","#F6B26B","#FFD966","#93C47D","#76A5AF","#6D9EEB","#6FA8DC","#8E7CC3","#C27BA0","#A61C00","#CC0000","#E69138","#F1C232","#6AA84F","#45818E","#3C78D8","#3D85C6","#674EA7","#A64D79"],N=[{label:"Normal",value:null},{label:"H1",value:1},{label:"H2",value:2},{label:"H3",value:3}],C=e.computed((()=>"center"===c.value.align?"https://img.icons8.com/ios/50/666666/align-center.png":"right"===c.value.align?"https://img.icons8.com/ios/50/666666/align-right.png":"https://img.icons8.com/ios/50/666666/align-left.png")),V=e.ref(!1),T=e.computed((()=>d.value||f.value||V.value)),b=e=>{B("align",e),V.value=!1},S=()=>{const e=`#${i.value}`;uni.createSelectorQuery().in(s.proxy).select(e).context((o=>{o&&o.context?(r.value=o.context,n.modelValue&&r.value.setContents({html:n.modelValue})):t("error","at components/Todo/TodoEditor.vue:186",`Không tìm thấy Editor Context cho ID: ${e}`)})).exec()},x=e.ref("");e.watch((()=>n.modelValue),(e=>{e!==x.value&&r.value&&e&&r.value.setContents({html:e})}));const D=e=>{const t=e.detail.html;x.value=t,l("update:modelValue",t)},_=e=>{c.value=e.detail,e.detail.color&&(y.value=e.detail.color),e.detail.backgroundColor&&(E.value=e.detail.backgroundColor),e.detail.hasOwnProperty("link")?(g.value=!0,u.value=e.detail.link||""):(g.value=!1,u.value=""),r.value&&r.value.getSelectionText({success:e=>{e.text&&e.text.length>0?(p.value=!0,g.value||(m.value=e.text)):(p.value=!1,g.value||(m.value=""))},fail:()=>{p.value=!1}})},B=(e,t)=>{r.value&&r.value.format(e,t)},I=()=>{g.value||p.value?(p.value&&!g.value&&(u.value=""),d.value=!0,e.nextTick((()=>{v.value=!0}))):uni.showToast({title:"Bôi đen chữ để chèn Link",icon:"none"})},A=()=>{d.value=!1,v.value=!1},O=e=>{const t=N[e.detail.value];w.value=t.label,B("header",t.value)},L=e=>{h.value=e,f.value=!0},F=()=>{f.value=!1},$=e=>{"color"===h.value?(y.value=e||U,B("color",e)):(E.value=e||j,B("backgroundColor",e)),F()},M=()=>{uni.chooseImage({count:1,success:e=>r.value.insertImage({src:e.tempFilePaths[0],width:"80%"})})},R=()=>{uni.chooseVideo({count:1,success:e=>r.value.insertVideo({src:e.tempFilePath,width:"80%"})})};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"editor-wrapper"},[e.createElementVNode("view",{class:"toolbar"},[e.createElementVNode("view",{class:"tool-row"},[e.createElementVNode("view",{class:e.normalizeClass(["tool-item",{active:c.value.bold}]),onTouchend:o[0]||(o[0]=e.withModifiers((e=>B("bold")),["prevent"]))},[e.createElementVNode("text",{class:"txt-icon bold"},"B")],34),e.createElementVNode("view",{class:e.normalizeClass(["tool-item",{active:c.value.italic}]),onTouchend:o[1]||(o[1]=e.withModifiers((e=>B("italic")),["prevent"]))},[e.createElementVNode("text",{class:"txt-icon italic"},"I")],34),e.createElementVNode("view",{class:e.normalizeClass(["tool-item",{active:c.value.underline}]),onTouchend:o[2]||(o[2]=e.withModifiers((e=>B("underline")),["prevent"]))},[e.createElementVNode("text",{class:"txt-icon underline"},"U")],34),e.createElementVNode("view",{class:e.normalizeClass(["tool-item",{active:c.value.strike}]),onTouchend:o[3]||(o[3]=e.withModifiers((e=>B("strike")),["prevent"]))},[e.createElementVNode("text",{class:"txt-icon strike"},"S")],34),e.createElementVNode("view",{class:"tool-divider"}),e.createElementVNode("view",{class:"tool-item",onTouchend:o[4]||(o[4]=e.withModifiers((e=>B("list","ordered")),["prevent"]))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/numbered-list.png",class:"img-tool"})],32),e.createElementVNode("view",{class:"tool-item",onTouchend:o[5]||(o[5]=e.withModifiers((e=>B("list","bullet")),["prevent"]))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/list.png",class:"img-tool"})],32),e.createElementVNode("picker",{range:N,"range-key":"label",onChange:O,class:"tool-picker"},[e.createElementVNode("view",{class:"picker-label"},e.toDisplayString(w.value)+" ▾",1)],32)]),e.createElementVNode("view",{class:"tool-row"},[e.createElementVNode("view",{class:"tool-item",onClick:o[6]||(o[6]=e=>L("color"))},[e.createElementVNode("text",{class:"txt-icon color-text",style:e.normalizeStyle({color:y.value})},"A",4),e.createElementVNode("view",{class:"color-bar",style:e.normalizeStyle({backgroundColor:y.value})},null,4)]),e.createElementVNode("view",{class:"tool-item",onClick:o[7]||(o[7]=e=>L("backgroundColor"))},[e.createElementVNode("text",{class:"txt-icon bg-text",style:e.normalizeStyle({backgroundColor:E.value})},"A",4)]),e.createElementVNode("view",{class:"tool-divider"}),e.createElementVNode("view",{class:"tool-item",onClick:o[8]||(o[8]=e=>V.value=!0)},[e.createElementVNode("image",{src:C.value,class:"img-tool"},null,8,["src"])]),e.createElementVNode("view",{class:"tool-divider"}),e.createElementVNode("view",{class:e.normalizeClass(["tool-item",{active:g.value,disabled:!p.value&&!g.value}]),onClick:I},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/link--v1.png",class:"img-tool",style:e.normalizeStyle({opacity:p.value||g.value?1:.3})},null,4)],2),e.createElementVNode("view",{class:"tool-item",onClick:M},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/image.png",class:"img-tool"})]),e.createElementVNode("view",{class:"tool-item",onClick:R},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/video-call.png",class:"img-tool"})])])]),T.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"ql-container static-view"},[e.createElementVNode("rich-text",{nodes:t.modelValue||"<p style='color:#999'>Nhập mô tả...</p>"},null,8,["nodes"])])):e.createCommentVNode("",!0),e.createElementVNode("editor",{id:i.value,class:"ql-container",placeholder:t.placeholder||"Nhập nội dung...","show-img-size":!0,"show-img-toolbar":!0,"show-img-resize":!0,onReady:S,onInput:D,onStatuschange:_},null,40,["id","placeholder"]),f.value?(e.openBlock(),e.createElementBlock("view",{key:1,class:"color-popup-overlay",onClick:F},[e.createElementVNode("view",{class:"color-popup",onClick:o[10]||(o[10]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("text",{class:"popup-title"},"Chọn màu"),e.createElementVNode("view",{class:"color-grid"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(k,(t=>e.createElementVNode("view",{key:t,class:"color-cell",style:e.normalizeStyle({backgroundColor:t}),onClick:e=>$(t)},null,12,["onClick"]))),64)),e.createElementVNode("view",{class:"color-cell remove-color",onClick:o[9]||(o[9]=e=>$(null))},"✕")])])])):e.createCommentVNode("",!0),f.value?(e.openBlock(),e.createElementBlock("view",{key:2,class:"color-popup-overlay",onClick:F},[e.createElementVNode("view",{class:"color-popup",onClick:o[12]||(o[12]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("text",{class:"popup-title"},"Chọn màu"),e.createElementVNode("view",{class:"color-grid"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(k,(t=>e.createElementVNode("view",{key:t,class:"color-cell",style:e.normalizeStyle({backgroundColor:t}),onClick:e=>$(t)},null,12,["onClick"]))),64)),e.createElementVNode("view",{class:"color-cell remove-color",onClick:o[11]||(o[11]=e=>$(null))},"✕")])])])):e.createCommentVNode("",!0),d.value?(e.openBlock(),e.createElementBlock("view",{key:3,class:"link-popup-overlay",onClick:A},[e.createElementVNode("view",{class:"link-popup",onClick:o[13]||(o[13]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("text",{class:"popup-title"},"Chèn liên kết")])])):e.createCommentVNode("",!0),V.value?(e.openBlock(),e.createElementBlock("view",{key:4,class:"color-popup-overlay",onClick:o[19]||(o[19]=e=>V.value=!1)},[e.createElementVNode("view",{class:"link-popup",onClick:o[18]||(o[18]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("text",{class:"popup-title"},"Căn chỉnh"),e.createElementVNode("view",{class:"align-grid"},[e.createElementVNode("view",{class:e.normalizeClass(["tool-item align-item",{active:"left"===c.value.align}]),onClick:o[14]||(o[14]=e=>b("left"))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/align-left.png",class:"img-tool"})],2),e.createElementVNode("view",{class:e.normalizeClass(["tool-item align-item",{active:"center"===c.value.align}]),onClick:o[15]||(o[15]=e=>b("center"))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/align-center.png",class:"img-tool"})],2),e.createElementVNode("view",{class:e.normalizeClass(["tool-item align-item",{active:"right"===c.value.align}]),onClick:o[16]||(o[16]=e=>b("right"))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/align-right.png",class:"img-tool"})],2),e.createElementVNode("view",{class:e.normalizeClass(["tool-item align-item",{active:"justify"===c.value.align}]),onClick:o[17]||(o[17]=e=>b("justify"))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/align-justify.png",class:"img-tool"})],2)])])])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-b2550ab9"]]),ye=me(e.defineComponent({__name:"TodoDatePicker",props:{dueDate:{},notifyDate:{},notifyTime:{}},emits:["update:dueDate","update:notifyDate","update:notifyTime","change"],setup(t,{emit:o}){const a=o,n=(e,t)=>{a(`update:${t}`,e.detail.value),setTimeout((()=>{a("change",{field:t,value:e.detail.value})}),50)},l=e=>{if(!e)return"";try{if(e.includes("-")){const[t,o,a]=e.split("-");return`${a}/${o}/${t}`}return e}catch(t){return e}};return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"flat-item date-compound-block"},[e.createElementVNode("view",{class:"right-column"},[e.createElementVNode("view",{class:"date-row"},[e.createElementVNode("picker",{mode:"date",value:t.dueDate,onChange:o[0]||(o[0]=e=>n(e,"dueDate")),onCancel:()=>{},class:"full-width-picker"},[e.createElementVNode("view",{class:e.normalizeClass(["item-picker",{"placeholder-color":!t.dueDate}])},[e.createElementVNode("text",{class:"picker-label"},"Hạn xử lý:"),e.createTextVNode(" "+e.toDisplayString(t.dueDate?l(t.dueDate):"Chọn ngày"),1)],2)],40,["value"])]),e.createElementVNode("view",{class:"inner-divider"}),e.createElementVNode("view",{class:"date-row split-row"},[e.createElementVNode("picker",{mode:"date",value:t.notifyDate,onChange:o[1]||(o[1]=e=>n(e,"notifyDate")),class:"half-picker"},[e.createElementVNode("view",{class:e.normalizeClass(["item-picker",{"placeholder-color":!t.notifyDate}])},[e.createElementVNode("text",{class:"picker-label"},"Ngày thông báo:"),e.createTextVNode(" "+e.toDisplayString(t.notifyDate?l(t.notifyDate):"Ngày"),1)],2)],40,["value"]),e.createElementVNode("view",{class:"vertical-divider"}),e.createElementVNode("picker",{mode:"time",value:t.notifyTime,onChange:o[2]||(o[2]=e=>n(e,"notifyTime")),class:"half-picker"},[e.createElementVNode("view",{class:e.normalizeClass(["item-picker",{"placeholder-color":!t.notifyTime}])},e.toDisplayString(t.notifyTime?t.notifyTime:"Giờ"),3)],40,["value"])])])]))}}),[["__scopeId","data-v-f0c9adc4"]]),Ee=me({__name:"UserAvatar",props:{name:{type:String,default:""},avatarUrl:{type:String,default:""},avatarColor:{type:String,default:"#3b82f6"},size:{type:Number,default:40}},setup(t){const o=t,a=e.computed((()=>o.name?o.name.trim().charAt(0).toUpperCase():"?"));return(o,n)=>(e.openBlock(),e.createElementBlock("view",{class:"rounded-full flex items-center justify-center overflow-hidden shrink-0",style:e.normalizeStyle({width:t.size+"px",height:t.size+"px",backgroundColor:t.avatarColor||"#e0e0e0",borderRadius:"50%"})},[t.avatarUrl?(e.openBlock(),e.createElementBlock("image",{key:0,src:t.avatarUrl,class:"w-full h-full",mode:"aspectFill"},null,8,["src"])):(e.openBlock(),e.createElementBlock("text",{key:1,class:"text-white font-bold flex items-center justify-center",style:e.normalizeStyle({fontSize:.45*t.size+"px",lineHeight:"1",display:"flex"})},e.toDisplayString(a.value),5))],4))}},[["__scopeId","data-v-50fe1991"]]),we=me(e.defineComponent({__name:"CustomerModal",props:{visible:{type:Boolean},customers:{},loading:{type:Boolean}},emits:["close","select"],setup(t,{emit:o}){const a=o,n=()=>{a("close")},l=e=>{if(!e)return"";const t=new Date(e);return`${t.getDate()}/${t.getMonth()+1}/${t.getFullYear()}`};return(t,o)=>t.visible?(e.openBlock(),e.createElementBlock("view",{key:0,class:"modal-overlay",onClick:e.withModifiers(n,["stop"])},[e.createElementVNode("view",{class:"modal-content",onClick:o[0]||(o[0]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"Chọn khách hàng"),e.createElementVNode("text",{class:"close-btn",onClick:n},"✕")]),t.loading?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-state"},"Đang tải dữ liệu...")):(e.openBlock(),e.createElementBlock("scroll-view",{key:1,"scroll-y":"",class:"customer-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.customers,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"customer-item",onClick:e=>(e=>{a("select",e),n()})(t)},[e.createVNode(Ee,{name:t.name,size:40,class:"mr-3"},null,8,["name"]),e.createElementVNode("view",{class:"info-column"},[e.createElementVNode("text",{class:"name-text"},e.toDisplayString(t.name||"(Không tên)"),1),e.createElementVNode("text",{class:"phone-text"},e.toDisplayString(t.phone||"Không có SĐT"),1)]),e.createElementVNode("view",{class:"date-column"},[e.createElementVNode("text",{class:"date-text"},e.toDisplayString(l(t.createAt)),1)])],8,["onClick"])))),128)),0===t.customers.length?(e.openBlock(),e.createElementBlock("view",{key:0,class:"empty-state"},"Không có dữ liệu")):e.createCommentVNode("",!0)]))])])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-4918022a"]]),ke=e.defineComponent({__name:"create_todo",setup(t){const{loading:o,form:a,goBack:n,submitForm:l,memberOptions:i,onMemberChange:r,currentAssigneeName:c,showCustomerModal:s,loadingCustomer:d,customerList:u,openCustomerPopup:m,onCustomerSelect:p,sourceOptions:g,sourceIndex:v,onSourceChange:f}=fe();return(t,h)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/edit--v1.png",class:"item-icon"})]),e.withDirectives(e.createElementVNode("input",{class:"item-input","onUpdate:modelValue":h[0]||(h[0]=t=>e.unref(a).name=t),placeholder:"Nhập tên công việc *",maxlength:"29"},null,512),[[e.vModelText,e.unref(a).name]])]),e.createVNode(he,{modelValue:e.unref(a).desc,"onUpdate:modelValue":h[1]||(h[1]=t=>e.unref(a).desc=t)},null,8,["modelValue"]),e.createElementVNode("view",{class:"flat-item",onClick:h[2]||(h[2]=(...t)=>e.unref(m)&&e.unref(m)(...t))},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/price-tag.png",class:"item-icon"})]),e.createElementVNode("view",{class:e.normalizeClass(["input-trigger",{placeholder:!e.unref(a).customer}])},e.toDisplayString(e.unref(a).customer||"Chọn khách hàng"),3),e.createElementVNode("text",{class:"arrow-icon"},"›")]),e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/internet.png",class:"item-icon"})]),e.createElementVNode("picker",{mode:"selector",range:e.unref(g),onChange:h[3]||(h[3]=(...t)=>e.unref(f)&&e.unref(f)(...t)),class:"full-width-picker"},[e.createElementVNode("view",{class:e.normalizeClass(["picker-display",{"placeholder-color":-1===e.unref(v)}])},e.toDisplayString(e.unref(v)>-1?e.unref(g)[e.unref(v)]:"Chọn nguồn"),3)],40,["range"]),e.createElementVNode("text",{class:"arrow-icon"},"›")]),e.createVNode(we,{visible:e.unref(s),loading:e.unref(d),customers:e.unref(u),onClose:h[4]||(h[4]=e=>s.value=!1),onSelect:e.unref(p)},null,8,["visible","loading","customers","onSelect"]),e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/user.png",class:"item-icon"})]),e.createElementVNode("picker",{mode:"selector",range:e.unref(i),onChange:h[5]||(h[5]=(...t)=>e.unref(r)&&e.unref(r)(...t)),class:"full-width-picker"},[e.createElementVNode("view",{class:e.normalizeClass(["picker-display",{"placeholder-color":!e.unref(c)}])},e.toDisplayString(e.unref(c)?e.unref(c):"Người được giao"),3)],40,["range"])]),e.createVNode(ye,{dueDate:e.unref(a).dueDate,"onUpdate:dueDate":h[6]||(h[6]=t=>e.unref(a).dueDate=t),notifyDate:e.unref(a).notifyDate,"onUpdate:notifyDate":h[7]||(h[7]=t=>e.unref(a).notifyDate=t),notifyTime:e.unref(a).notifyTime,"onUpdate:notifyTime":h[8]||(h[8]=t=>e.unref(a).notifyTime=t)},null,8,["dueDate","notifyDate","notifyTime"]),e.createElementVNode("view",{class:"footer-action"},[e.createElementVNode("button",{class:"btn btn-cancel",onClick:h[9]||(h[9]=(...t)=>e.unref(n)&&e.unref(n)(...t))},"Hủy bỏ"),e.createElementVNode("button",{class:"btn btn-submit",disabled:e.unref(o),onClick:h[10]||(h[10]=(...t)=>e.unref(l)&&e.unref(l)(...t))},e.toDisplayString(e.unref(o)?"Đang lưu...":"Lưu công việc"),9,["disabled"])])]))}}),Ne=e=>{if(!e||e<=0)return"";try{const t=new Date(e),o=t.getFullYear(),a=(t.getMonth()+1).toString().padStart(2,"0");return`${o}-${a}-${t.getDate().toString().padStart(2,"0")}`}catch{return""}},Ce=e=>{if(!e||e<=0)return"";try{const t=new Date(e),o=t.getHours().toString().padStart(2,"0");return`${o}:${t.getMinutes().toString().padStart(2,"0")}`}catch{return""}},Ve=e=>{if(!e)return"";const t=Date.now()-e;if(t<6e4)return"Vừa xong";if(t<36e5){return`${Math.floor(t/6e4)} phút trước`}if(t<864e5){return`${Math.floor(t/36e5)} giờ trước`}const o=new Date(e);return`${o.getDate().toString().padStart(2,"0")}/${(o.getMonth()+1).toString().padStart(2,"0")}/${o.getFullYear()} ${o.getHours().toString().padStart(2,"0")}:${o.getMinutes().toString().padStart(2,"0")}`},Te=()=>{const o=W(),a=o.uid,n=e.ref(!1),l=e.ref(!1),r=e.ref(!1),c=e.ref([]),s=e.ref([]),d=e.ref(!1),u=e.ref(""),m=e.ref(!1),p=e.ref(!1),g=e.ref(null),v=e.ref(!1),f=e.ref(""),h=e.ref(!1),y=e.ref(!1),E=e.ref(!1),w=e.ref(null),k=e.ref(""),N=e.ref(!1),C=e.ref(null),V=e.ref(0),T=["","COMMENT"],b=e.ref(!1),S=(e,t="00:00")=>{if(!e)return 0;try{const o=`${e}T${t}:00`;return new Date(o).getTime()}catch{return 0}},I=e.computed((()=>!R.value.raw||"DONE"===R.value.raw.status)),A=()=>{E.value=!1,O()},O=()=>{y.value=!1,w.value=null,k.value="",u.value=""},L=()=>{N.value=!1,C.value=null},F=e.ref(null),$=e.ref(0),M=["ALL","TODO","TICKET","HISTORY_CALL","CUSTOMER","NOTE"],R=e.ref({id:"",title:"",code:"Loading...",desc:"",statusIndex:0,sourceIndex:0,assigneeIndex:0,assigneeId:"",dueDate:"",notifyDate:"",notifyTime:"",customerCode:"",customerName:"",customerNameLabel:"",customerPhone:"",customerPhoneLabel:"",customerManagerName:"",customerManagerLabel:""}),P=e.ref([]),U=e.ref([]),j=e.computed((()=>{const e=[{label:"Chưa xử lý",value:"TO_DO"},{label:"Đang xử lý",value:"IN_PROGRESS"},{label:"Hoàn thành",value:"DONE"}];return R.value.raw&&"IN_PROGRESS"===R.value.raw.status?e.filter((e=>"TO_DO"!==e.value)):e})),z=e.computed((()=>j.value.map((e=>e.label)))),K=()=>{v.value=!1,F.value=null,u.value="",f.value=""};i((async e=>{await X(),e&&e.id&&await te(e.id)}));const X=async()=>{try{const e=await de();P.value=e,U.value=e.map((e=>e.UserName||"Thành viên ẩn danh"))}catch(e){t("error","at controllers/todo_detail.ts:618","Lỗi lấy members",e)}},te=async e=>{n.value=!0;try{const t=await(e=>J({url:`${q}/getDetail`,method:"GET",data:{id:e,projectCode:Y}}))(e),o=(e=>{if(!e)return null;let t=[Q,Z,ee].indexOf(e.status);-1===t&&(t=0);let o=[x,D,_,B].indexOf(e.links);-1===o&&(o=0);const a=e.notificationReceivedAt||0;return{id:e.id,title:e.title||"",code:e.code||"",desc:e.description||"",statusIndex:t,sourceIndex:o,assigneeIndex:0,assigneeId:e.assigneeId||"",dueDate:Ne(e.dueDate),notifyDate:Ne(a),notifyTime:Ce(a),customerCode:e.customerCode||"",customerName:"",customerNameLabel:"Tên khách hàng",customerPhone:"",customerPhoneLabel:"Số điện thoại",customerManagerName:"",raw:e}})(t&&t.data&&!t.id?t.data:t);if(o){R.value=o;const t=o.raw.status,a=j.value.findIndex((e=>e.value===t));if(-1!==a&&(R.value.statusIndex=a),ne(e),R.value.assigneeId&&P.value.length>0){const e=P.value.findIndex((e=>e.memberUID===R.value.assigneeId));-1!==e&&(R.value.assigneeIndex=e)}R.value.customerCode&&(await le(R.value.customerCode),ie(R.value.customerCode))}}catch(o){t("error","at controllers/todo_detail.ts:653","❌ Lỗi lấy chi tiết:",o),uni.showToast({title:"Lỗi kết nối",icon:"none"})}finally{n.value=!1}},oe=e=>{var t;let o="Người dùng ẩn",a="?",n="#e3f2fd";if(e.senderId){const t=P.value.find((t=>t.UID===e.senderId||t.memberUID===e.senderId));t&&(o=t.UserName,t.AvatarColor&&(n=t.AvatarColor))}a=o.charAt(0).toUpperCase();let l="";"COMMENT"===e.type?l="đã thêm một bình luận":"LOG"===e.type?l="đã cập nhật hoạt động":"UPDATE_TODO"===e.type&&(l="cập nhật thông tin công việc");const i=(null==(t=e.reactions)?void 0:t.details)||[];return{id:e.id,senderId:e.senderId,senderName:o,senderAvatarChar:a,senderAvatarColor:n,message:e.message||"",timeDisplay:Ve(e.createdAt),actionText:l,isEdited:!!e.updatedAt,type:e.type,reactions:i,children:[]}},ne=async e=>{d.value=!0;try{const t=T[V.value],o=await((e,t="")=>J({url:`${H}/api/module-todo/todoMessages/getAllNoPageWithReact`,method:"GET",data:{todoId:e,keySearch:t}}))(e,t);Array.isArray(o)?s.value=o.map((e=>{const t=oe(e);return e.replies&&e.replies.length>0&&(t.children=e.replies.map((e=>oe(e)))),t})):s.value=[]}catch(o){t("error","at controllers/todo_detail.ts:724","Lỗi lấy bình luận:",o)}finally{d.value=!1}},le=async e=>{var a;l.value=!0;try{const t=o.todoToken;if(!t)return;const n=await((e,t)=>J({url:`${G}/Customer/getDetail`,method:"GET",data:{uid:t},header:{Authorization:`Bearer ${e}`}}))(t,e),i=n.fields||(null==(a=n.data)?void 0:a.fields)||[],r=i.find((e=>"name"===e.code)),c=i.find((e=>"phone"===e.code)),s=i.find((e=>"member_no"===e.code));if(r&&(R.value.customerName=r.value,R.value.customerNameLabel=r.name),c&&(R.value.customerPhone=c.value,R.value.customerPhoneLabel=c.name),s){R.value.customerManagerLabel=s.name;const e=s.value,t=P.value.find((t=>t.memberUID===e));R.value.customerManagerName=t?t.UserName:"(Chưa xác định)"}}catch(n){t("error","at controllers/todo_detail.ts:785","Lỗi CRM:",n)}finally{l.value=!1}},ie=async e=>{r.value=!0;try{const a=M[$.value],n=o.todoToken;if(!n)return void t("error","at controllers/todo_detail.ts:797","Chưa có Token CRM/Todo");const l=await((e,t,o="ALL")=>J({url:`${G}/ActionTimeline/getAll?from=-1&to=-1&customerUid=${t}&type=${o}&page=1&size=10&memberUid=&projectCode=`,method:"GET",header:{Authorization:`Bearer ${e}`}}))(n,e,a);Array.isArray(l)&&(c.value=l.map((e=>{const t=new Date(e.createAt),o=`${t.getDate().toString().padStart(2,"0")}/${(t.getMonth()+1).toString().padStart(2,"0")}/${t.getFullYear()}`;let a="Hệ thống";if(e.memberUid){const t=P.value.find((t=>t.memberUID===e.memberUid));t&&(a=t.UserName)}const n=ae[e.typeSub]||e.typeSub||"Tương tác khác";return{id:e.id,timeStr:o,content:n,actorName:a,originalType:e.typeSub}})))}catch(a){t("error","at controllers/todo_detail.ts:840","Lỗi lấy lịch sử:",a)}finally{r.value=!1}};return{isLoading:n,isLoadingCustomer:l,isLoadingHistory:r,historyList:c,form:R,statusOptions:z,sourceOptions:["Cuộc gọi","Khách hàng","Hội thoại","Tin nhắn"],assigneeOptions:U,onStatusChange:async e=>{const o=parseInt(e.detail.value),a=j.value[o];if(!a)return;R.value.statusIndex=o;const n=a.value;if(R.value.raw){uni.showLoading({title:"Đang cập nhật..."});try{const e={...R.value.raw,status:n,preFixCode:"TODO",description:R.value.desc,files:"",tagCodes:"",title:R.value.title||R.value.raw.title};t("log","at controllers/todo_detail.ts:890","Payload Update Status:",e);if(await ce(e)){uni.showToast({title:"Đã cập nhật trạng thái",icon:"success"}),R.value.raw.status=n;const e=j.value.findIndex((e=>e.value===n));R.value.statusIndex=-1!==e?e:0,R.value.customerCode&&await ie(R.value.customerCode),await ne(R.value.id)}}catch(l){t("error","at controllers/todo_detail.ts:907","Lỗi cập nhật trạng thái:",l),uni.showToast({title:"Lỗi cập nhật",icon:"none"})}finally{uni.hideLoading()}}},onSourceChange:e=>{R.value.sourceIndex=e.detail.value},onAssigneeChange:async e=>{const o=parseInt(e.detail.value);if(!P.value[o])return;const a=P.value[o].memberUID;if(R.value.assigneeIndex=o,R.value.assigneeId=a,R.value.raw){uni.showLoading({title:"Đang cập nhật người giao..."});try{const e={...R.value.raw,assigneeId:a,preFixCode:"TODO",description:R.value.desc,files:"",tagCodes:"",title:R.value.title||R.value.raw.title};t("log","at controllers/todo_detail.ts:956","Payload Update Assignee:",e);await ce(e)&&(uni.showToast({title:"Đã đổi người thực hiện",icon:"success"}),R.value.raw.assigneeId=a,R.value.customerCode&&await ie(R.value.customerCode),await ne(R.value.id))}catch(n){t("error","at controllers/todo_detail.ts:975","Lỗi cập nhật người giao:",n),uni.showToast({title:"Lỗi cập nhật",icon:"none"})}finally{uni.hideLoading()}}else uni.showToast({title:"Thiếu dữ liệu gốc",icon:"none"})},goBack:()=>{uni.navigateBack()},saveTodo:()=>{t("log","at controllers/todo_detail.ts:983","Lưu:",R.value),uni.showToast({title:"Đã lưu",icon:"success"})},historyFilterOptions:["Tất cả","Công việc","Ticket","Lịch sử gọi","Khách hàng","Ghi chú"],historyFilterIndex:$,onHistoryFilterChange:e=>{$.value=e.detail.value,R.value.customerCode&&ie(R.value.customerCode)},comments:s,isLoadingComments:d,newCommentText:u,isSubmittingComment:m,submitComment:async()=>{if(u.value&&u.value.trim()){m.value=!0;try{const e=R.value.id,a={todoId:e,senderId:o.uid,message:u.value,files:"",parentId:-1};t("log","at controllers/todo_detail.ts:577","Đang gửi bình luận:",a);await se(a)&&(uni.showToast({title:"Đã gửi bình luận",icon:"success"}),u.value="",await ne(e))}catch(e){t("error","at controllers/todo_detail.ts:595","Lỗi gửi bình luận:",e),uni.showToast({title:"Gửi thất bại",icon:"none"})}finally{m.value=!1}}else uni.showToast({title:"Vui lòng nhập nội dung",icon:"none"})},isConfirmDeleteCommentOpen:p,onRequestDeleteComment:e=>{g.value=e,p.value=!0},confirmDeleteComment:async()=>{if(g.value){p.value=!1;try{await(e=g.value,J({url:`${H}/api/module-todo/todoMessages/delete`,method:"POST",data:{id:e}})),uni.showToast({title:"Đã xóa",icon:"success"}),R.value.id&&await ne(R.value.id)}catch(o){t("error","at controllers/todo_detail.ts:539","Lỗi xóa bình luận:",o),uni.showToast({title:"Xóa thất bại",icon:"none"})}finally{g.value=null}var e}},cancelDeleteComment:()=>{p.value=!1,g.value=null},currentUserId:a,isEditingComment:v,onRequestEditComment:async o=>{const a=R.value.id;if(a){uni.showLoading({title:"Đang tải..."});try{const n=await((e,t)=>J({url:`${H}/api/module-todo/todoMessages/getDetail`,method:"GET",data:{id:e,todoId:t}}))(o,a);if(t("log","at controllers/todo_detail.ts:403","API Response Detail:",n),n){const o=n.data||n;F.value={id:o.id,todoId:o.todoId,senderId:o.senderId};const a=o.senderId,l=P.value.find((e=>e.UID===a));f.value=l?l.UserName:"tôi";const i=o.message||"";t("log","at controllers/todo_detail.ts:431","Nội dung edit:",i),v.value=!0,await e.nextTick(),u.value=i}}catch(n){t("error","at controllers/todo_detail.ts:443","Lỗi lấy chi tiết bình luận:",n),uni.showToast({title:"Lỗi tải dữ liệu",icon:"none"})}finally{uni.hideLoading()}}},submitUpdateComment:async()=>{if(F.value)if(u.value&&u.value.trim()){m.value=!0;try{const o={id:F.value.id,todoId:F.value.todoId,senderId:F.value.senderId,message:u.value,files:""};t("log","at controllers/todo_detail.ts:469","Payload Update:",o),await(e=o,J({url:`${H}/api/module-todo/todoMessages/update`,method:"POST",data:e})),uni.showToast({title:"Đã cập nhật",icon:"success"}),K(),await ne(R.value.id)}catch(o){t("error","at controllers/todo_detail.ts:483","Lỗi cập nhật:",o),uni.showToast({title:"Cập nhật thất bại",icon:"none"})}finally{m.value=!1}var e}else uni.showToast({title:"Nội dung không được để trống",icon:"none"})},onCancelEditComment:()=>{h.value=!0},isConfirmCancelEditOpen:h,continueEditing:()=>{h.value=!1},confirmCancelEdit:async()=>{h.value=!1,K(),R.value.id&&await ne(R.value.id)},editingMemberName:f,isEmojiPickerOpen:N,emojiList:["👍","👎","😍","😆","😱","😭","😤"],onToggleEmojiPicker:e=>{C.value=e,N.value=!0},closeEmojiPicker:L,selectEmoji:async e=>{if(!C.value)return;const a=C.value.id;L();const n=R.value.id,l=o.uid,i={todoId:Number(n),senderId:l,todoMessageId:Number(a),codeEmoji:e};t("log","at controllers/todo_detail.ts:319",">> Gửi Reaction:",i);try{await(r=i,J({url:`${H}/api/module-todo/todoMessages/reaction`,method:"POST",data:r}))&&(uni.showToast({title:"Đã thả cảm xúc",icon:"none"}),await ne(n))}catch(c){t("error","at controllers/todo_detail.ts:333","Lỗi thả cảm xúc:",c),uni.showToast({title:"Lỗi kết nối",icon:"none"})}var r},isReplying:y,isConfirmCancelReplyOpen:E,replyingCommentData:w,replyingMemberName:k,onRequestReply:async t=>{v.value=!1,F.value=null,u.value="",w.value=t,y.value=!0;const o=t.senderId,a=P.value.find((e=>e.UID===o));k.value=a?a.UserName:"Người dùng ẩn",await e.nextTick()},onCancelReply:()=>{u.value.trim()?E.value=!0:A()},confirmCancelReply:A,continueReplying:()=>{E.value=!1},submitReply:async()=>{if(u.value&&u.value.trim()){if(w.value){m.value=!0;try{const e=R.value.id,a={todoId:e,senderId:o.uid,message:u.value,files:"",parentId:w.value.id};t("log","at controllers/todo_detail.ts:259",">> Gửi trả lời:",a);await se(a)&&(uni.showToast({title:"Đã trả lời",icon:"success"}),O(),await ne(e))}catch(e){t("error","at controllers/todo_detail.ts:269","Lỗi gửi trả lời:",e),uni.showToast({title:"Gửi thất bại",icon:"none"})}finally{m.value=!1}}}else uni.showToast({title:"Vui lòng nhập nội dung",icon:"none"})},commentFilterIndex:V,commentFilterOptions:["Tất cả hoạt động","Bình luận"],onCommentFilterChange:e=>{const t=e.detail.value;V.value!==t&&(V.value=t,R.value.id&&ne(R.value.id))},isSavingDescription:b,onSaveDescription:async()=>{if(R.value.raw){b.value=!0;try{const e={...R.value.raw,preFixCode:"TODO",description:R.value.desc,files:"",tagCodes:"",title:R.value.title||R.value.raw.title};t("log","at controllers/todo_detail.ts:174","Payload Update Todo:",e);await ce(e)&&uni.showToast({title:"Đã cập nhật mô tả",icon:"success"})}catch(e){t("error","at controllers/todo_detail.ts:184","Lỗi cập nhật công việc:",e),uni.showToast({title:"Cập nhật thất bại",icon:"none"})}finally{b.value=!1}}else uni.showToast({title:"Không tìm thấy dữ liệu gốc",icon:"none"})},onDateUpdate:async e=>{if(R.value.raw){uni.showLoading({title:"Đang cập nhật..."});try{const o={...R.value.raw,preFixCode:"TODO",description:R.value.desc,files:"",tagCodes:"",title:R.value.title||R.value.raw.title};if("dueDate"===e.field)o.dueDate=S(e.value,"23:59");else if("notifyDate"===e.field||"notifyTime"===e.field){const t="notifyDate"===e.field?e.value:R.value.notifyDate,a="notifyTime"===e.field?e.value:R.value.notifyTime;t&&a&&(o.notificationReceivedAt=S(t,a))}t("log","at controllers/todo_detail.ts:122",`Payload Update ${e.field}:`,o);await ce(o)&&(uni.showToast({title:"Cập nhật thành công",icon:"success"}),"dueDate"===e.field?R.value.raw.dueDate=o.dueDate:R.value.raw.notificationReceivedAt=o.notificationReceivedAt,R.value.customerCode&&await ie(R.value.customerCode),await ne(R.value.id))}catch(o){t("error","at controllers/todo_detail.ts:143","Lỗi cập nhật ngày:",o),uni.showToast({title:"Lỗi cập nhật",icon:"none"})}finally{uni.hideLoading()}}},isStatusDisabled:I,dynamicStatusOptions:j}},be=me(e.defineComponent({__name:"CommentItem",props:{data:{},isReply:{type:Boolean}},emits:["react","reply","edit","delete"],setup(t,{emit:o}){const a=t,n=W(),l=e.computed((()=>String(a.data.senderId)===String(n.uid)));return(t,o)=>(e.openBlock(),e.createElementBlock("view",{class:"comment-thread"},[e.createElementVNode("view",{class:"flex gap-3 mb-4 items-start"},[e.createVNode(Ee,{name:t.data.senderName,"avatar-color":t.data.senderAvatarColor,size:t.isReply?30:40,class:e.normalizeClass(["shrink-0",t.isReply?"mr-2":"mr-3"])},null,8,["name","avatar-color","size","class"]),e.createElementVNode("view",{class:"flex-1 overflow-hidden"},[e.createElementVNode("view",{class:"bg-gray-50 rounded-2xl p-3 rounded-tl-none relative"},[e.createElementVNode("view",{class:"flex justify-between items-start mb-1"},[e.createElementVNode("text",{class:"font-bold text-sm text-gray-900"},e.toDisplayString(t.data.senderName),1),e.createElementVNode("view",{class:"flex items-center"},[e.createElementVNode("text",{class:"text-xs text-gray-400"},e.toDisplayString(t.data.timeDisplay),1),t.data.isEdited?(e.openBlock(),e.createElementBlock("text",{key:0,class:"text-xs text-gray-400 italic ml-1"},"• Đã sửa")):e.createCommentVNode("",!0)])]),e.createElementVNode("rich-text",{nodes:t.data.message,class:"text-sm text-gray-700 leading-normal"},null,8,["nodes"])]),e.createElementVNode("view",{class:"c-footer-actions"},[e.createElementVNode("view",{class:"reaction-row"},[t.data.reactions&&t.data.reactions.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"flex gap-1 mt-1"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.data.reactions,((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"emoji-tag"},e.toDisplayString(t.codeEmoji),1)))),128))])):e.createCommentVNode("",!0)]),"UPDATE_TODO"!==t.data.type?(e.openBlock(),e.createElementBlock("view",{key:0,class:"action-buttons-container"},[e.createElementVNode("view",{class:"btn-icon-action",onClick:o[0]||(o[0]=e=>t.$emit("react",t.data))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/999999/happy--v1.png",class:"icon-action"})]),e.createElementVNode("view",{class:"btn-icon-action",onClick:o[1]||(o[1]=e=>t.$emit("reply",t.data))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/999999/speech-bubble--v1.png",class:"icon-action"})]),l.value?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("view",{class:"btn-icon-action",onClick:o[2]||(o[2]=e=>t.$emit("edit",t.data))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/999999/create-new.png",class:"icon-action"})]),e.createElementVNode("view",{class:"btn-icon-action",onClick:o[3]||(o[3]=e=>t.$emit("delete",t.data.id))},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/999999/trash--v1.png",class:"icon-action"})])],64)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0)])])]),t.data.children&&t.data.children.length>0?(e.openBlock(),e.createElementBlock("view",{key:0,class:"pl-12 mt-2 replies-wrapper"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.data.children,(a=>(e.openBlock(),e.createBlock(be,{key:a.id,data:a,"is-reply":!0,onReact:o[4]||(o[4]=e=>t.$emit("react",e)),onReply:o[5]||(o[5]=e=>t.$emit("reply",e)),onEdit:o[6]||(o[6]=e=>t.$emit("edit",e)),onDelete:o[7]||(o[7]=e=>t.$emit("delete",e))},null,8,["data"])))),128))])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-21a2a55f"]]),Se=me(e.defineComponent({__name:"todo_detail",setup(t){const{isLoading:o,isLoadingCustomer:a,isLoadingHistory:n,historyList:l,form:i,statusOptions:r,sourceOptions:c,assigneeOptions:s,onStatusChange:d,onSourceChange:u,onAssigneeChange:m,saveTodo:p,historyFilterOptions:g,historyFilterIndex:v,onHistoryFilterChange:f,comments:h,isLoadingComments:y,newCommentText:E,isSubmittingComment:w,submitComment:k,isConfirmDeleteCommentOpen:N,onRequestDeleteComment:C,confirmDeleteComment:V,cancelDeleteComment:T,currentUserId:b,isEditingComment:S,onRequestEditComment:x,submitUpdateComment:D,onCancelEditComment:_,isConfirmCancelEditOpen:B,continueEditing:I,confirmCancelEdit:A,editingMemberName:O,isEmojiPickerOpen:L,emojiList:F,onToggleEmojiPicker:$,closeEmojiPicker:M,selectEmoji:R,isReplying:P,replyingMemberName:U,replyingCommentData:j,onRequestReply:z,onCancelReply:H,submitReply:G,isConfirmCancelReplyOpen:K,continueReplying:q,confirmCancelReply:Y,commentFilterIndex:X,commentFilterOptions:W,onCommentFilterChange:J,isSavingDescription:Q,onSaveDescription:Z,onDateUpdate:ee,isStatusDisabled:te}=Te(),oe=e.ref(!1),ae=()=>{oe.value=!oe.value};return(t,u)=>(e.openBlock(),e.createElementBlock("view",{class:"container"},[e.unref(o)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-overlay"},[e.createElementVNode("text",null,"Đang tải...")])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"detail-header"},[e.createElementVNode("view",{class:"header-top"},[e.createElementVNode("text",{class:"header-code"},"#"+e.toDisplayString(e.unref(i).code),1)]),e.withDirectives(e.createElementVNode("input",{class:"header-title-input","onUpdate:modelValue":u[0]||(u[0]=t=>e.unref(i).title=t),placeholder:"Tên công việc"},null,512),[[e.vModelText,e.unref(i).title]])]),e.createElementVNode("scroll-view",{"scroll-y":"true",class:"detail-body"},[e.createElementVNode("view",{class:"section-title"},"Mô tả"),e.createElementVNode("view",{class:"section-block"},[e.createVNode(he,{modelValue:e.unref(i).desc,"onUpdate:modelValue":u[1]||(u[1]=t=>e.unref(i).desc=t),placeholder:"Nhập mô tả công việc..."},null,8,["modelValue"]),e.createElementVNode("view",{class:"input-actions",style:{"margin-top":"10px"}},[e.createElementVNode("button",{class:"btn-save-comment",disabled:e.unref(Q),onClick:u[2]||(u[2]=(...t)=>e.unref(Z)&&e.unref(Z)(...t))},e.toDisplayString(e.unref(Q)?"Đang lưu...":"Lưu lại"),9,["disabled"])])]),e.createElementVNode("view",{class:"section-title"},"Thông tin công việc"),e.createElementVNode("view",{class:"info-group"},[e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/checked-checkbox.png",class:"item-icon"}),e.createElementVNode("text",{class:"item-label"},"Trạng thái")]),e.createElementVNode("picker",{mode:"selector",range:e.unref(r),value:e.unref(i).statusIndex,disabled:e.unref(te),onChange:u[3]||(u[3]=(...t)=>e.unref(d)&&e.unref(d)(...t)),class:"item-picker-box"},[e.createElementVNode("view",{class:e.normalizeClass(["picker-text",{"disabled-text":e.unref(te)}])},[e.createTextVNode(e.toDisplayString(e.unref(r)[e.unref(i).statusIndex])+" ",1),e.unref(te)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("text",{key:0},"▾"))],2)],40,["range","value","disabled"])]),e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/internet.png",class:"item-icon"}),e.createElementVNode("text",{class:"item-label"},"Nguồn")]),e.createElementVNode("view",{class:"item-picker-box"},[e.createElementVNode("view",{class:"picker-text disabled-text"},e.toDisplayString(e.unref(c)[e.unref(i).sourceIndex]||"Không xác định"),1)])]),e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/user.png",class:"item-icon"}),e.createElementVNode("text",{class:"item-label"},"Người được giao")]),e.createElementVNode("picker",{mode:"selector",range:e.unref(s),value:e.unref(i).assigneeIndex,onChange:u[4]||(u[4]=(...t)=>e.unref(m)&&e.unref(m)(...t)),class:"item-picker-box"},[e.createElementVNode("view",{class:"picker-text"},e.toDisplayString(e.unref(i).assigneeIndex>-1&&e.unref(s)[e.unref(i).assigneeIndex]?e.unref(s)[e.unref(i).assigneeIndex]:"Chọn người giao")+" ▾ ",1)],40,["range","value"])]),e.createVNode(ye,{dueDate:e.unref(i).dueDate,"onUpdate:dueDate":u[5]||(u[5]=t=>e.unref(i).dueDate=t),notifyDate:e.unref(i).notifyDate,"onUpdate:notifyDate":u[6]||(u[6]=t=>e.unref(i).notifyDate=t),notifyTime:e.unref(i).notifyTime,"onUpdate:notifyTime":u[7]||(u[7]=t=>e.unref(i).notifyTime=t),onChange:e.unref(ee)},null,8,["dueDate","notifyDate","notifyTime","onChange"])]),e.createElementVNode("view",{class:"section-title"},"Thông tin khách hàng"),e.createElementVNode("view",{class:"info-group customer-block"},[e.unref(a)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-row"},[e.createElementVNode("text",{class:"loading-text"},"Đang tải thông tin từ CRM...")])):e.unref(i).customerCode?(e.openBlock(),e.createElementBlock("view",{key:2},[e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/user-male-circle.png",class:"item-icon"}),e.createElementVNode("text",{class:"item-label"},e.toDisplayString(e.unref(i).customerNameLabel),1)]),e.createElementVNode("view",{class:"item-right-text"},e.toDisplayString(e.unref(i).customerName),1)]),e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/phone.png",class:"item-icon"}),e.createElementVNode("text",{class:"item-label"},e.toDisplayString(e.unref(i).customerPhoneLabel),1)]),e.createElementVNode("view",{class:"item-right-text phone-text"},e.toDisplayString(e.unref(i).customerPhone),1)]),e.createElementVNode("view",{class:"flat-item"},[e.createElementVNode("view",{class:"item-left"},[e.createElementVNode("image",{src:"https://img.icons8.com/ios/50/666666/manager.png",class:"item-icon"}),e.createElementVNode("text",{class:"item-label"},e.toDisplayString(e.unref(i).customerManagerLabel),1)]),e.createElementVNode("view",{class:"item-right-text highlight-text"},e.toDisplayString(e.unref(i).customerManagerName||"(Chưa có)"),1)])])):(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-row"},[e.createElementVNode("text",null,"(Công việc này chưa gắn với khách hàng nào)")]))]),e.createElementVNode("view",{class:"section-header-row"},[e.createElementVNode("view",{class:"toggle-header",onClick:ae},[e.createElementVNode("text",{class:"section-title no-margin"},"Bình luận và hoạt động"),e.createElementVNode("image",{src:"https://img.icons8.com/ios-glyphs/30/666666/expand-arrow--v1.png",class:e.normalizeClass(["toggle-icon",{open:oe.value}])},null,2)]),e.createElementVNode("picker",{mode:"selector",range:e.unref(W),value:e.unref(X),onClick:u[8]||(u[8]=e.withModifiers((()=>{}),["stop"])),onChange:u[9]||(u[9]=(...t)=>e.unref(J)&&e.unref(J)(...t))},[e.createElementVNode("view",{class:"filter-badge"},e.toDisplayString(e.unref(W)[e.unref(X)])+" ▾ ",1)],40,["range","value"])]),oe.value?(e.openBlock(),e.createElementBlock("view",{key:0,class:"comments-section"},[e.createElementVNode("view",{class:"comment-input-block"},[e.createElementVNode("view",{class:"editor-container"},[e.createVNode(he,{modelValue:e.unref(E),"onUpdate:modelValue":u[10]||(u[10]=t=>e.isRef(E)?E.value=t:null),placeholder:e.unref(S)?"Đang chỉnh sửa...":e.unref(P)?"Viết câu trả lời...":"Viết bình luận"},null,8,["modelValue","placeholder"])]),e.unref(S)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"editing-alert"},[e.createElementVNode("text",{class:"editing-text"},[e.createTextVNode(" Đang chỉnh sửa bình luận của "),e.createElementVNode("text",{class:"editing-name"},e.toDisplayString(e.unref(O)),1)])])):e.createCommentVNode("",!0),e.unref(P)&&e.unref(j)?(e.openBlock(),e.createElementBlock("view",{key:1,class:"reply-alert"},[e.createElementVNode("view",{class:"reply-info"},[e.createElementVNode("text",{class:"reply-label"},"Đang trả lời bình luận của "),e.createElementVNode("text",{class:"reply-name"},e.toDisplayString(e.unref(U)),1)]),e.createElementVNode("view",{class:"reply-quote"},[e.createElementVNode("text",{class:"quote-icon"},"“"),e.createElementVNode("rich-text",{nodes:e.unref(j).message,class:"quote-content"},null,8,["nodes"]),e.createElementVNode("text",{class:"quote-icon"},"”")])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"input-actions"},[e.unref(S)||e.unref(P)?e.unref(S)?(e.openBlock(),e.createElementBlock("view",{key:1,class:"edit-actions-row"},[e.createElementVNode("button",{class:"btn-cancel-edit",disabled:e.unref(w),onClick:u[12]||(u[12]=(...t)=>e.unref(_)&&e.unref(_)(...t))},"Hủy",8,["disabled"]),e.createElementVNode("button",{class:"btn-save-comment",disabled:e.unref(w),onClick:u[13]||(u[13]=(...t)=>e.unref(D)&&e.unref(D)(...t))},e.toDisplayString(e.unref(w)?"Đang cập nhật...":"Cập nhật bình luận"),9,["disabled"])])):e.unref(P)?(e.openBlock(),e.createElementBlock("view",{key:2,class:"edit-actions-row"},[e.createElementVNode("button",{class:"btn-cancel-edit",disabled:e.unref(w),onClick:u[14]||(u[14]=(...t)=>e.unref(H)&&e.unref(H)(...t))},"Hủy",8,["disabled"]),e.createElementVNode("button",{class:"btn-save-comment",disabled:e.unref(w),onClick:u[15]||(u[15]=(...t)=>e.unref(G)&&e.unref(G)(...t))},e.toDisplayString(e.unref(w)?"Đang gửi...":"Trả lời"),9,["disabled"])])):e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn-save-comment",disabled:e.unref(w),onClick:u[11]||(u[11]=(...t)=>e.unref(k)&&e.unref(k)(...t))},e.toDisplayString(e.unref(w)?"Đang lưu...":"Lưu lại"),9,["disabled"]))])]),e.createElementVNode("view",{class:"divider-line"}),e.unref(y)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-row"},[e.createElementVNode("text",null,"Đang tải bình luận...")])):0===e.unref(h).length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-row"},[e.createElementVNode("text",null,"Chưa có bình luận nào.")])):(e.openBlock(),e.createElementBlock("view",{key:2},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),(t=>(e.openBlock(),e.createBlock(be,{key:t.id,data:t,onReact:e.unref($),onReply:e.unref(z),onEdit:u[16]||(u[16]=t=>e.unref(x)(t.id)),onDelete:u[17]||(u[17]=t=>e.unref(C)(t))},null,8,["data","onReact","onReply"])))),128))]))])):e.createCommentVNode("",!0),e.unref(B)?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal-overlay",onClick:u[20]||(u[20]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-container"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"Xác nhận hủy")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,"Bạn có chắc muốn hủy chỉnh sửa? Các thay đổi sẽ không được lưu.")]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:u[18]||(u[18]=(...t)=>e.unref(I)&&e.unref(I)(...t))},"Tiếp tục chỉnh sửa"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:u[19]||(u[19]=(...t)=>e.unref(A)&&e.unref(A)(...t))},"Có, hủy bỏ")])])])):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"section-header-row"},[e.createElementVNode("text",{class:"section-title no-margin"},"Lịch sử tương tác"),e.createElementVNode("picker",{mode:"selector",range:e.unref(g),value:e.unref(v),onChange:u[21]||(u[21]=(...t)=>e.unref(f)&&e.unref(f)(...t))},[e.createElementVNode("view",{class:"filter-badge"},e.toDisplayString(e.unref(g)[e.unref(v)])+" ▾ ",1)],40,["range","value"])]),e.createElementVNode("view",{class:"history-container"},[e.unref(n)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"loading-row"},[e.createElementVNode("text",{class:"loading-text"},"Đang tải lịch sử...")])):0===e.unref(l).length?(e.openBlock(),e.createElementBlock("view",{key:1,class:"empty-row"},[e.createElementVNode("text",null,"(Không tìm thấy dữ liệu)")])):(e.openBlock(),e.createElementBlock("view",{key:2,class:"timeline-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:t.id,class:"timeline-item"},[o!==e.unref(l).length-1?(e.openBlock(),e.createElementBlock("view",{key:0,class:"timeline-line"})):e.createCommentVNode("",!0),e.createElementVNode("view",{class:"timeline-dot"}),e.createElementVNode("view",{class:"timeline-content"},[e.createElementVNode("view",{class:"timeline-header"},[e.createElementVNode("text",{class:"t-actor"},e.toDisplayString(t.actorName),1),e.createElementVNode("text",{class:"t-time"},e.toDisplayString(t.timeStr),1)]),e.createElementVNode("text",{class:"t-action"},e.toDisplayString(t.content),1)])])))),128))]))]),e.createElementVNode("view",{style:{height:"50px"}})]),e.unref(N)?(e.openBlock(),e.createElementBlock("view",{key:1,class:"modal-overlay",onClick:u[24]||(u[24]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"modal-container"},[e.createElementVNode("view",{class:"modal-header"},[e.createElementVNode("text",{class:"modal-title"},"Xác nhận xóa")]),e.createElementVNode("view",{class:"modal-body"},[e.createElementVNode("text",null,"Bạn có chắc muốn xóa bình luận này không?")]),e.createElementVNode("view",{class:"modal-footer"},[e.createElementVNode("button",{class:"modal-btn cancel",onClick:u[22]||(u[22]=(...t)=>e.unref(T)&&e.unref(T)(...t))},"Hủy"),e.createElementVNode("button",{class:"modal-btn confirm",onClick:u[23]||(u[23]=(...t)=>e.unref(V)&&e.unref(V)(...t))},"Xác nhận")])])])):e.createCommentVNode("",!0),e.unref(L)?(e.openBlock(),e.createElementBlock("view",{key:2,class:"modal-overlay",onClick:u[26]||(u[26]=(...t)=>e.unref(M)&&e.unref(M)(...t))},[e.createElementVNode("view",{class:"emoji-picker-container",onClick:u[25]||(u[25]=e.withModifiers((()=>{}),["stop"]))},[e.createElementVNode("view",{class:"emoji-grid"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(F),((t,o)=>(e.openBlock(),e.createElementBlock("view",{key:o,class:"emoji-item",onClick:o=>e.unref(R)(t)},e.toDisplayString(t),9,["onClick"])))),128))])])])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-ecf93d6c"]]);__definePage("pages/todo/list_todo",ge),__definePage("pages/todo/create_todo",ke),__definePage("pages/todo/todo_detail",Se);const xe=e.defineComponent({__name:"App",setup:e=>(l((e=>{t("log","at App.vue:6","App Launch");W().initialize(e)})),a((()=>{t("log","at App.vue:13","App Show")})),n((()=>{t("log","at App.vue:17","App Hide")})),()=>{})});const{app:De,Vuex:_e,Pinia:Be}=function(){const t=e.createVueApp(xe);return t.use(g()),{app:t,Pinia:S}}();uni.Vuex=_e,uni.Pinia=Be,De.provide("__globalStyles",__uniConfig.styles),De._component.mpType="app",De._component.render=()=>{},De.mount("#app")}(Vue);
